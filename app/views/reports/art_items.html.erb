<%# app/views/reports/art_items.html.erb %>
<h1 class="text-2xl font-bold mb-4">Art Items Report</h1>

<% if @departments.any? %>
  <%= form_with url: art_items_reports_path, method: :get, local: true, html: { id: 'report-form', class: 'mb-6' } do |form| %>
    <div class="mb-4">
      <%= form.label :department_id, 'Department', class: 'block font-semibold mb-1' %>
      <%= form.select :department_id, options_for_select([['All Departments', '']] + @departments.map { |d| [d.fullname, d.id] }, @selected_department&.id), {}, class: 'border rounded px-3 py-2 w-full', id: 'department_id_select' %>
    </div>
  <% end %>
  <%= button_to 'Download CSV', art_items_reports_path(format: :csv), method: :get, params: {}, class: 'bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded', id: 'download-csv-btn' %>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var btn = document.getElementById('download-csv-btn');
      var select = document.getElementById('department_id_select');
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        var depId = select.value;
        var url = '<%= art_items_reports_path(format: :csv) %>';
        if(depId) { url += '?department_id=' + encodeURIComponent(depId); }
        window.location = url;
      });
    });
  </script>
<% else %>
  <div class="text-red-600">No departments available for your account.</div>
<% end %>
